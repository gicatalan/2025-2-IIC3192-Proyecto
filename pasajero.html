<!DOCTYPE html>
<html>
<head>
    <title>Aviso Pasajero</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; display: flex; flex-direction: column; align-items: center; box-sizing: border-box; }
        h1 { margin-bottom: 10px; }
        #status { width: 90%; padding: 20px; margin: 15px 0; border-radius: 10px; background-color: #f0f0f0; font-size: 1.2em; font-weight: bold; }
        #paradero-input { width: 90%; padding: 15px; font-size: 18px; margin-bottom: 25px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        #avisarBtn { width: 90%; height: 70px; font-size: 18px; font-weight: bold; color: white; background-color: dodgerblue; border: none; border-radius: 10px; cursor: pointer; transition: background-color 0.3s; }
        #avisarBtn:disabled { background-color: grey; cursor: not-allowed; }
        .status-enviado { background-color: #e2e3e5; color: #383d41; }
        .status-recibido { background-color: #d4edda; color: #155724; }
        .status-error { background-color: #f8d7da; color: #721c24; }
        .status-exito { background-color: #cce5ff; color: #004085; }
    </style>
</head>
<body>
    <h1>Avisar al Conductor</h1>
    <div id="status">Listo para avisar</div>
    <input type="text" id="paradero-input" placeholder="Ingresa el código del paradero">
    <button id="avisarBtn">Avisar al Conductor</button>

    <script src="https://app.protobject.com/framework/p.js"></script>
    <script src="config.js"></script>
    <script>
        const statusDiv = document.getElementById('status');
        const paraderoInput = document.getElementById('paradero-input');
        const avisarBtn = document.getElementById('avisarBtn');
        Protobject.Haptic.start();

        Protobject.Core.onReceived(function (mensaje) {
            if (mensaje.tipo === 'AVISO_RECIBIDO') {
                setStatus("¡Recibido! El conductor ha sido notificado.", 'status-recibido');
                Protobject.Haptic.vibrate([200]);
            } else if (mensaje.tipo === 'BUS_LLENO') {
                setStatus("El conductor informa: Bus Lleno.", 'status-error');
                setTimeout(resetButton, 5000);
            } else if (mensaje.tipo === 'OPERACION_EXITOSA') {
                setStatus("¡Éxito! Puedes subir al bus.", 'status-exito');
                setTimeout(resetButton, 5000);
            }
        });

        avisarBtn.onclick = () => {
            const paradero = paraderoInput.value;
            if (!paradero) { alert("Por favor, ingresa el código del paradero."); return; }
            const mensaje = { tipo: 'SOLICITUD_PARADA', paradero: paradero };
            Protobject.Core.send(mensaje).to("conductor.html");
            setStatus("Aviso enviado. Esperando confirmación del conductor...", 'status-enviado');
            avisarBtn.innerText = "ESPERANDO...";
            avisarBtn.disabled = true;
        };
        
        function setStatus(mensaje, clase) {
            statusDiv.innerText = mensaje;
            statusDiv.className = clase;
        }
        function resetButton() {
          avisarBtn.innerText = "Avisar al Conductor";
          avisarBtn.disabled = false;
          setStatus("Listo para avisar", "");
        }
    </script>
</body>
</html>